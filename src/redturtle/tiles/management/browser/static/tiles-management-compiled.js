"use strict";define("tiles-management-pattern",["jquery","pat-base","pat-registry","mockup-patterns-modal","mockup-patterns-sortable","mockup-i18n","babel-polyfill"],function(u,e,h,m,g,s){return e.extend({name:"tiles-management",trigger:".pat-tiles-management",parser:"mockup",defaults:{},init:function(){var e,c=this.options.managerId,p="false"!==this.options.useModal,f=0<(e=window.navigator.userAgent).indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/");!function(){if("function"==typeof window.CustomEvent)return;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.CustomEvent=e}();c?function(d,e){var t,i,n=u("body").data("baseUrl")+"/tiles_management";t=d,i=u("body").data("portalUrl"),t.html('<div class="loading-tiles"><img src="'+i+'/++resource++redturtle.tiles.management/loader.svg" alt="loading"/></div>');var a={managerId:c,ajax_load:!0};f&&(a.invalidIECache=(new Date).getTime()),u.get(n,a).done(function(e){if(u(e).length){d.html(u(e));var t,i=new CustomEvent("rtTilesLoaded");d[0].dispatchEvent(i),0!==(t=d.find('[class*="pat-"]')).length&&t.each(function(){var i=this;this.className.split(" ").map(function(e){if(-1!==e.indexOf("pat-")){var t=e.substring(4);try{h.initPattern(t,i,e)}catch(e){if(e instanceof TypeError)return}}})});var n,a,s=d.find(".add-tile-btn");if(0<s.length){var l=JSON.parse(d.find(".tilesList").attr("data-tilesinfo")),o=u('<div class="tileEditButtons" style="z-index:100000">\n                  <a class="plone-btn plone-btn-info tileEditLink" href="#">\n                    <span class="icon-edit" aria-hidden="true"></span>\n                  </a>\n                  <a class="plone-btn plone-btn-warning tileVisibilityLink" href="#">\n                  </a>\n                  <a class="plone-btn plone-btn-danger tileDeleteLink" href="#">\n                    <span class="icon-delete" aria-hidden="true">&times;</span>\n                  </a>\n                </div>'),r=u("body").data("baseUrl");d.find(".tilesList .tileWrapper").each(function(){var a,e=o.clone(),t=u(this).data("tileid");this.setAttribute("data-token",l[t].token),e.find(".tileEditLink").attr("href",r+"/@@edit-tile/"+l[t].tile_type+"/"+t),e.find(".tileVisibilityLink").attr("href",r+"/@@show_hide_tiles?tileId="+t+"&_authenticator="+l[t].token),l[t].tile_hidden?(u(this).addClass("hiddenTile"),e.find(".tileVisibilityLink").append(u('<span class="icon-view" aria-hidden="true"><span class="sr-only">Show</span></span>'))):e.find(".tileVisibilityLink").append(u('<span class="glyphicon glyphicon-eye-close"  aria-hidden="true"><span class="sr-only">Hide</span></span>')),e.find(".tileDeleteLink").attr("href",r+"/@@delete-tile/"+l[t].tile_type+"/"+t),u(this).prepend(e),d.find(".tileEditButtons").hide(),a=u(this),p&&(a.find("div.tileEditButtons a.tileDeleteLink").each(function(){new m(u(this),{templateOptions:{classModal:"plone-modal-content delete-tile-modal"},actionOptions:{redirectOnResponse:!1,onSuccess:function(e,t,i,n,a){"success"===i&&(e.hide(),e.reloadWindow())}}}).on("after-render",function(){u("form#delete_tile").append('<input type="hidden" name="managerId" value="'+c+'" />')})}),a.find("div.tileEditButtons a.tileEditLink").each(function(){new m(u(this),{templateOptions:{classModal:"plone-modal-content edit-tile-modal"},actionOptions:{redirectOnResponse:!0}})})),a.find("div.tileEditButtons a.tileVisibilityLink").each(function(){u(this).click(function(e){e.preventDefault();var n=u(e.currentTarget),t={managerId:c,ajax_load:!0};f&&(t.invalidIECache=(new Date).getTime()),u.get(n.attr("href")+"&managerId="+c,t).done(function(e){if(void 0===e){var t=n.find("> span");t.hasClass("icon-view")?(t.removeClass("icon-view").addClass("glyphicon glyphicon-eye-close"),t.find("> span").html("Show")):(t.removeClass("glyphicon glyphicon-eye-close").addClass("icon-view"),t.find("> span").html("Hide")),a.toggleClass("hiddenTile")}else{var i=JSON.parse(e);console.error(i.error)}}).fail(function(e){console.error(e)})})}),a.mouseenter(function(){u(this).addClass("editableTile"),u(this).find(".tileEditButtons").show()}).mouseleave(function(){u(this).removeClass("editableTile"),u(this).find(".tileEditButtons").hide()})}),991<window.innerWidth&&(n=d,a=u("body").data().baseUrl||u("base").attr("href"),new g(n.find(".tilesList"),{selector:"div.tileWrapper",drop:function(e,t){if(0!==t){var i=u(".tileWrapper").map(function(e,t){return u(t).data().tileid});if(void 0!==a){var n={managerId:c,ajax_load:!0,tileIds:JSON.stringify(i.get()),_authenticator:e.data("token")};f&&(n.invalidIECache=(new Date).getTime()),u.get(a+"/reorder_tiles",n).done(function(e){if(e&&""!==e){var t=JSON.parse(e);console.error(t.message)}}).fail(function(e){console.error(e)})}}}})),s.each(function(){u(this).click(function(e){var t,i,n,a;e.preventDefault(),t=u(this),i=e.target.href,n=u(t),0===(a=n.next(".available-tiles")).length?(n.parent().append('<div class="available-tiles"></div>'),(a=n.next(".available-tiles")).hide(),a.load(i+" #content .list-group",function(){p&&a.find("a.list-group-item").each(function(){new m(u(this),{actionOptions:{redirectOnResponse:!0,redirectToUrl:window.location.href}}).on("after-render",function(){u("form#add_tile").append('<input type="hidden" name="managerId" value="'+c+'" />')})}),u(this).slideDown()})):a.slideToggle()})})}}else d.remove()}).fail(function(e){console.trace(e);var t=new s,i="redturtle.tiles.management";t.loadCatalog(i);var n=t.MessageFactory(i);d.html('<p class="error-manager">'+n("error_loading_manager")+"</p>")})}(this.$el):this.$el.append("<span>to use tiles manager, you need to provide a managerId attribute</span>")}})}),require(["tiles-management-pattern"],function(){}),define("src/redturtle/tiles/management/browser/static/bundle.js",function(){});
//# sourceMappingURL=redturtle-tiles-management-compiled.js.map