"use strict";define("tiles-management-pattern",["jquery","pat-base","pat-registry","mockup-patterns-modal","mockup-patterns-sortable","mockup-i18n","babel-polyfill"],function(s,e,r,c,t,u){return e.extend({name:"tiles-management",trigger:".pat-tiles-management",parser:"mockup",defaults:{},init:function(){var e,o=this.options.managerId,l=0<(e=window.navigator.userAgent).indexOf("MSIE ")||0<e.indexOf("Trident/")||0<e.indexOf("Edge/");!function(){if("function"==typeof window.CustomEvent)return;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();var d=function(e){var a=s("body").data().baseUrl||s("base").attr("href");new t(e.find(".tilesList"),{selector:"div.tileWrapper",drop:function(e,t){if(0!==t){var n=s(".tileWrapper").map(function(e,t){return s(t).data().tileid});if(void 0!==a){var i={managerId:o,ajax_load:!0,tileIds:JSON.stringify(n.get()),_authenticator:e.data("token")};l&&(i.invalidIECache=(new Date).getTime()),s.get(a+"/reorder_tiles",i).done(function(e){if(e&&""!==e){var t=JSON.parse(e);console.error(t.message)}}).fail(function(e){console.error(e)})}}}})};o?function(a){var e,t,n=s("body").data("baseUrl")+"/tiles_management";e=a,t=s("body").data("portalUrl"),e.html('<div class="loading-tiles"><img src="'+t+'/++resource++redturtle.tiles.management/loader.svg" alt="loading"/></div>');var i={managerId:o,ajax_load:!0};l&&(i.invalidIECache=(new Date).getTime()),s("body").hasClass("userrole-anonymous")&&s.ajaxSetup({cache:!0}),s.get(n,i).done(function(e){if(s.ajaxSetup({cache:!1}),s(e).length){a.html(s(e));var t,n=new CustomEvent("rtTilesLoaded");a[0].dispatchEvent(n),0!==(t=a.find('[class*="pat-"]')).length&&t.each(function(){var n=this;this.className.split(" ").map(function(e){if(-1!==e.indexOf("pat-")){var t=e.substring(4);try{r.initPattern(t,n,e)}catch(e){if(e instanceof TypeError)return}}})});var i=a.find(".add-tile-btn");0<i.length&&(a.find(".tilesList .tileWrapper").each(function(){a.find(".tileEditButtons").hide(),function a(e){var r=s(e);r.find("div.tileEditButtons a.tileDeleteLink").each(function(){new c(s(this),{templateOptions:{classModal:"plone-modal-content delete-tile-modal"},actionOptions:{redirectOnResponse:!1,timeout:1e4,onSuccess:function(e,t,n,i,a){"success"===n&&(e.hide(),e.reloadWindow())}}}).on("after-render",function(){s("form#delete_tile").append('<input type="hidden" name="managerId" value="'+o+'" />')})}),r.find("div.tileEditButtons a.tileEditLink").each(function(){new c(s(this),{templateOptions:{classModal:"plone-modal-content edit-tile-modal"},actionOptions:{redirectOnResponse:!0,timeout:1e4}})}),r.find("div.tileEditButtons a.tileVisibilityLink, div.tileEditButtons .tileSizeLink a").each(function(){s(this).click(function(e){e.preventDefault();var t={managerId:o,ajax_load:!0};l&&(t.invalidIECache=(new Date).getTime()),s.get(e.currentTarget.href,t).done(function(e){if(void 0===e){var t=s("body").data("baseUrl")+"/tiles_management",n={managerId:o,ajax_load:!0};l&&(n.invalidIECache=(new Date).getTime()),s.get(t,n).done(function(e){var t=r.data("tileid"),n=s("<div></div>").html(e).find('.tilesList .tileWrapper[data-tileid="'+t+'"]');r.replaceWith(n),a(n);var i=n.parents(".tilesWrapper");1===i.length&&991<window.innerWidth&&d(s(i[0]))})}else{var i=JSON.parse(e);console.error(i.error)}}).fail(function(e){console.error(e)})})}),r.mouseenter(function(){s(this).addClass("editableTile"),s(this).find(".tileEditButtons").show()}).mouseleave(function(){s(this).removeClass("editableTile"),s(this).find(".tileEditButtons").hide()})}(this)}),991<window.innerWidth&&d(a),i.each(function(){s(this).click(function(e){var t,n,i,a;e.preventDefault(),t=s(this),n=e.target.href,i=s(t),0===(a=i.next(".available-tiles")).length?(i.parent().append('<div class="available-tiles"></div>'),(a=i.next(".available-tiles")).hide(),a.load(n+" #content .list-group",function(){a.find("a.list-group-item").each(function(){new c(s(this),{actionOptions:{redirectOnResponse:!0,timeout:1e4,redirectToUrl:window.location.href}}).on("after-render",function(){s("form#add_tile").append('<input type="hidden" name="managerId" value="'+o+'" />')})}),s(this).slideDown()})):a.slideToggle()})}))}else a.remove()}).fail(function(e){s.ajaxSetup({cache:!1}),console.trace(e);var t=new u,n="redturtle.tiles.management";t.loadCatalog(n);var i=t.MessageFactory(n);a.html('<p class="error-manager">'+i("error_loading_manager")+"</p>")})}(this.$el):this.$el.append("<span>to use tiles manager, you need to provide a managerId attribute</span>")}})}),require(["tiles-management-pattern"],function(){}),define("src/redturtle/tiles/management/browser/static/bundle.js",function(){});
//# sourceMappingURL=redturtle-tiles-management-compiled.js.map