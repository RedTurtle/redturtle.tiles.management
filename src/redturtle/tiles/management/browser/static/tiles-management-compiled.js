"use strict";define("tiles-management-pattern",["jquery","pat-base","pat-registry","mockup-patterns-modal","mockup-patterns-sortable","mockup-i18n","babel-polyfill"],function(u,e,f,h,m,a){return e.extend({name:"tiles-management",trigger:".pat-tiles-management",parser:"mockup",defaults:{},init:function(){var d=this.options.managerId,c="false"!==this.options.useModal;!function(){if("function"==typeof window.CustomEvent)return;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),i}e.prototype=window.Event.prototype,window.CustomEvent=e}();var p,e,t,i;d?(p=this.$el,i=u("body").data("baseUrl")+"/tiles_management",e=p,t=u("body").data("portalUrl"),e.html('<div class="loading-tiles"><img src="'+t+'/++resource++redturtle.tiles.management/loader.svg" alt="loading"/></div>'),u.get(i,{managerId:d,ajax_load:!0}).done(function(e){if(u(e).length){p.html(u(e));var t,i=new CustomEvent("rtTilesLoaded");p[0].dispatchEvent(i),0!==(t=p.find('[class*="pat-"]')).length&&t.each(function(){var i=this;this.className.split(" ").map(function(e){if(-1!==e.indexOf("pat-")){var t=e.substring(4);try{f.initPattern(t,i,e)}catch(e){if(e instanceof TypeError)return}}})});var n,a,s=p.find(".add-tile-btn");if(0<s.length){var l=JSON.parse(p.find(".tilesList").attr("data-tilesinfo")),o=u('<div class="tileEditButtons" style="z-index:100000">    <a class="plone-btn plone-btn-info tileEditLink"      href="#">      <span class="icon-edit" aria-hidden="true"></span>    </a>    <a class="plone-btn plone-btn-warning tileVisibilityLink"      href="#">    </a>    <a class="plone-btn plone-btn-danger tileDeleteLink"      href="#">      <span class="icon-delete" aria-hidden="true">X</span>    </a></div>'),r=u("body").data("baseUrl");p.find(".tilesList .tileWrapper").each(function(){var a,e=o.clone(),t=u(this).data("tileid");this.setAttribute("data-token",l[t].token),e.find(".tileEditLink").attr("href",r+"/@@edit-tile/"+l[t].tile_type+"/"+t),e.find(".tileVisibilityLink").attr("href",r+"/@@show_hide_tiles?tileId="+t+"&_authenticator="+l[t].token),l[t].tile_hidden?(u(this).addClass("hiddenTile"),e.find(".tileVisibilityLink").append(u('<span class="icon-view" aria-hidden="true"><span class="sr-only">Show</span></span>'))):e.find(".tileVisibilityLink").append(u('<span class="glyphicon glyphicon-eye-close"  aria-hidden="true"><span class="sr-only">Hide</span></span>')),e.find(".tileDeleteLink").attr("href",r+"/@@delete-tile/"+l[t].tile_type+"/"+t),u(this).prepend(e),p.find(".tileEditButtons").hide(),a=u(this),c&&(a.find("div.tileEditButtons a.tileDeleteLink").each(function(){new h(u(this),{templateOptions:{classModal:"plone-modal-content delete-tile-modal"},actionOptions:{redirectOnResponse:!1,onSuccess:function(e,t,i,n,a){"success"===i&&(e.hide(),e.reloadWindow())}}}).on("after-render",function(){u("form#delete_tile").append('<input type="hidden" name="managerId" value="'+d+'" />')})}),a.find("div.tileEditButtons a.tileEditLink").each(function(){new h(u(this),{templateOptions:{classModal:"plone-modal-content edit-tile-modal"},actionOptions:{redirectOnResponse:!0}})})),a.find("div.tileEditButtons a.tileVisibilityLink").each(function(){u(this).click(function(e){e.preventDefault();var n=u(e.currentTarget);u.get(n.attr("href")+"&managerId="+d).done(function(e){if(void 0===e){var t=n.find(">span");t.hasClass("icon-view")?(t.removeClass("icon-view").addClass("glyphicon glyphicon-eye-close"),t.find(">span").html("Show")):(t.removeClass("glyphicon glyphicon-eye-close").addClass("icon-view"),t.find(">span").html("Hide")),a.toggleClass("hiddenTile")}else{var i=JSON.parse(e);console.error(i.error)}}).fail(function(e){console.error(e)})})}),a.mouseenter(function(){u(this).addClass("editableTile"),u(this).find(".tileEditButtons").show()}).mouseleave(function(){u(this).removeClass("editableTile"),u(this).find(".tileEditButtons").hide()})}),n=p,a=u("body").data().baseUrl||u("base").attr("href"),new m(n.find(".tilesList"),{selector:"div.tileWrapper",drop:function(e,t){if(0!==t){var i=u(".tileWrapper").map(function(e,t){return u(t).data().tileid});void 0!==a&&u.get(a+"/reorder_tiles",{tileIds:JSON.stringify(i.get()),managerId:d,_authenticator:e.data("token")}).done(function(e){if(e&&""!==e){var t=JSON.parse(e);console.error(t.message)}}).fail(function(e){console.error(e)})}}}),s.each(function(){u(this).click(function(e){var t,i,n,a;e.preventDefault(),t=u(this),i=e.target.href,n=u(t),0===(a=n.next(".available-tiles")).length?(n.parent().append('<div class="available-tiles"></div>'),(a=n.next(".available-tiles")).hide(),a.load(i+" #content .list-group",function(){a.find("a.list-group-item").each(function(){new h(u(this),{actionOptions:{redirectOnResponse:!0}}).on("after-render",function(){u("form#add_tile").append('<input type="hidden" name="managerId" value="'+d+'" />')})}),u(this).slideDown()})):a.slideToggle()})})}}else p.remove()}).fail(function(e){console.trace(e);var t=new a,i="redturtle.tiles.management";t.loadCatalog(i);var n=t.MessageFactory(i);p.html('<p class="error-manager">'+n("error_loading_manager")+"</p>")})):this.$el.append("<span>to use tiles manager, you need to provide a managerId attribute</span>")}})}),require(["tiles-management-pattern"],function(){}),define("src/redturtle/tiles/management/browser/static/bundle.js",function(){});
//# sourceMappingURL=redturtle-tiles-management-compiled.js.map