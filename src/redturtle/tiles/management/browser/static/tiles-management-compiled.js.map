{"version":3,"sources":["tiles-management-compiled.js"],"names":["define","$","Base","registry","Modal","Sortable","Pattern","extend","name","trigger","parser","defaults","init","_this","managerId","options","initializeAddButton","button","url","$button","container","next","length","parent","append","hide","load","find","each","addTileModal","actionOptions","redirectOnResponse","on","slideDown","slideToggle","enableEditButtons","tile","$tile","deleteModal","templateOptions","classModal","onSuccess","self","response","state","xhr","form","reloadWindow","editModal","click","e","preventDefault","get","currentTarget","href","done","data","undefined","result","JSON","parse","console","error","contentlUrl","tilesInfosUrl","ajax_load","tileId","html","newTile","replaceWith","parents","enableSorting","fail","mouseenter","addClass","show","mouseleave","removeClass","absoluteUrl","baseUrl","attr","sortable","selector","drop","$el","delta","tileIds","map","index","obj","tileid","stringify","message","enablePatterns","tags","className","split","cssClass","indexOf","pattern","substring","initPattern","TypeError","loadManager","event","Event","dispatchEvent","addButton","target","require"],"mappings":"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","file":"tiles-management-compiled.js","sourcesContent":["define('tiles-management-pattern', [\n  'jquery',\n  'pat-base',\n  'pat-registry',\n  'mockup-patterns-modal',\n  'mockup-patterns-sortable',\n], function ($, Base, registry, Modal, Sortable) {\n  'use strict';\n  var Pattern = Base.extend({\n    name: 'tiles-management',\n    trigger: '.pat-tiles-management',\n    parser: 'mockup',\n    defaults: {\n    },\n    init: function () {\n      const _this = this;\n      const managerId = this.options.managerId;\n\n      const initializeAddButton = function (button, url) {\n        const $button = $(button);\n        var container = $button.next('.available-tiles');\n        if (container.length === 0) {\n          $button.parent().append('<div class=\"available-tiles\"></div>');\n          container = $button.next('.available-tiles');\n          container.hide();\n          container.load(url + ' #content .list-group', function () {\n            container.find('a.list-group-item').each(function () {\n              const addTileModal = new Modal($(this), {\n                actionOptions: {\n                  redirectOnResponse: true,\n                },\n              });\n              addTileModal.on('after-render', function () {\n                $('form#add_tile').append('<input type=\"hidden\" name=\"managerId\" value=\"' + managerId + '\" />');\n              });\n            });\n\n            $(this).slideDown();\n          });\n        } else {\n          container.slideToggle();\n        }\n      };\n\n      const enableEditButtons = function (tile) {\n        //edit buttons modals\n        const $tile = $(tile);\n        $tile.find('div.tileEditButtons a.tileDeleteLink').each(function () {\n          const deleteModal = new Modal($(this), {\n            templateOptions: {\n              classModal: 'plone-modal-content delete-tile-modal',\n            },\n            actionOptions: {\n              redirectOnResponse: false,\n              onSuccess: function (self, response, state, xhr, form) {\n                if (state === 'success') {\n                  self.hide();\n                  self.reloadWindow();\n                }\n              },\n            },\n          });\n          deleteModal.on('after-render', function () {\n            $('form#delete_tile').append('<input type=\"hidden\" name=\"managerId\" value=\"' + managerId + '\" />');\n          });\n        });\n\n        $tile.find('div.tileEditButtons a.tileEditLink').each(function () {\n          const editModal = new Modal($(this), {\n            templateOptions: {\n              classModal: 'plone-modal-content edit-tile-modal',\n            },\n            actionOptions: {\n              redirectOnResponse: true,\n            },\n          });\n        });\n\n        $tile.find('div.tileEditButtons a.tileVisibilityLink').each(function () {\n          $(this).click(function (e) {\n            e.preventDefault();\n            $.get(e.currentTarget.href + '&managerId=' + managerId)\n              .done(function (data) {\n                if (data !== undefined) {\n                  const result = JSON.parse(data);\n                  console.error(result.error);\n                  return;\n                }\n\n                const contentlUrl = $('body').data('baseUrl');\n                const tilesInfosUrl = contentlUrl + '/tiles_management';\n                $.get(tilesInfosUrl, { managerId: managerId, ajax_load: true })\n                  .done(function (data) {\n                    const tileId = $tile.data('tileid');\n                    const html = $('<div></div>').html(data);\n                    const newTile = html.find('.tilesList .tileWrapper[data-tileid=\"' + tileId + '\"]');\n                    $tile.replaceWith(newTile);\n                    enableEditButtons(newTile);\n                    const container = newTile.parents('.tilesWrapper');\n                    if (container.length === 1) {\n                      enableSorting($(container[0]));\n                    }\n                  });\n              })\n              .fail(function (error) {\n                console.error(error);\n              });\n          });\n        });\n\n        $tile.mouseenter(function () {\n          $(this).addClass('editableTile');\n          $(this).find('.tileEditButtons').show();\n        }).mouseleave(function () {\n          $(this).removeClass('editableTile');\n          $(this).find('.tileEditButtons').hide();\n        });\n      };\n\n      const enableSorting = function (container) {\n        const absoluteUrl = $('body').data().baseUrl || $('base').attr('href');\n        const sortable = new Sortable(container.find('.tilesList'), {\n          selector: 'div.tileWrapper',\n          drop: function ($el, delta) {\n            if (delta !== 0) {\n              const tileIds = $('.tileWrapper').map(function (index, obj) {\n                return $(obj).data().tileid;\n              });\n\n              if (absoluteUrl !== undefined) {\n                $.get(\n                  absoluteUrl + '/reorder_tiles',\n                  {\n                    tileIds: JSON.stringify(tileIds.get()),\n                    managerId: managerId,\n                  })\n                  .done(function (data) {\n                    if (data && data !== '') {\n                      const result = JSON.parse(data);\n                      console.error(result.message);\n                    }\n                  })\n                  .fail(function (error) {\n                    console.error(error);\n                  });\n              }\n            }\n          },\n        });\n      };\n\n      const enablePatterns = function (container) {\n        // we need to manually enable patterns of tiles loaded with ajax because\n        // sometimes these are loaded after pattern inits\n        const tags = container.find('[class*=\"pat-\"]');\n        if (tags.length === 0) {\n          return;\n        }\n\n        tags.each(function () {\n          const _this = this;\n          this.className.split(' ').map(function (cssClass) {\n            if (cssClass.indexOf('pat-') !== -1) {\n              const pattern = cssClass.substring(4);\n              try {\n                registry.initPattern(pattern, _this, cssClass);\n              } catch (e) {\n                if (e instanceof TypeError) {\n                  //pattern already registered\n                  return;\n                }\n              }\n            }\n          });\n        });\n      };\n\n      const loadManager = function (container) {\n        const contentlUrl = $('body').data('baseUrl');\n        const tilesInfosUrl = contentlUrl + '/tiles_management';\n        $.get(tilesInfosUrl, { managerId: managerId, ajax_load: true })\n          .done(function (data) {\n            container.html($(data).find('.tilesWrapper'));\n            let event = new Event('rtTilesLoaded');\n            container[0].dispatchEvent(event);\n            enablePatterns(container);\n            const addButton = container.find('.add-tile-btn');\n            if (addButton.length > 0) {\n              container.find('.tilesList .tileWrapper').each(function () {\n                container.find('.tileEditButtons').hide();\n                enableEditButtons(this);\n              });\n\n              enableSorting(container);\n              addButton.each(function () {\n                $(this).click(function (e) {\n                  e.preventDefault();\n                  initializeAddButton($(this), e.target.href);\n                });\n              });\n            }\n          });\n      };\n\n      if (!managerId) {\n        _this.$el.append('<span>to use tiles manager, you need to provide a managerId attribute</span>');\n      } else {\n        loadManager(_this.$el);\n      }\n\n    },\n  });\n\n  return Pattern;\n});\n\nrequire([\n  'tiles-management-pattern',\n], function () {\n  'use strict';\n});\n\ndefine(\"src/redturtle/tiles/management/browser/static/bundle.js\", function(){});\n\n\n//# sourceMappingURL=tiles-management-compiled.js.map"]}