{"version":3,"sources":["tiles-management-compiled.js"],"names":["define","$","Base","registry","Modal","Sortable","I18n","Pattern","extend","name","trigger","parser","defaults","init","_this","managerId","options","isIE","ua","window","navigator","userAgent","msie","indexOf","trident","edge","customEventPolyfill","CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","document","createEvent","initCustomEvent","prototype","Event","initializeAddButton","button","url","$button","container","next","length","parent","append","hide","load","find","each","addTileModal","actionOptions","redirectOnResponse","timeout","redirectToUrl","location","href","on","slideDown","slideToggle","enableEditButtons","tile","$tile","deleteModal","templateOptions","classModal","onSuccess","self","response","state","xhr","form","reloadWindow","editModal","click","e","preventDefault","ajax_load","invalidIECache","Date","getTime","get","currentTarget","done","data","result","JSON","parse","console","error","contentlUrl","tilesInfosUrl","tileId","html","newTile","replaceWith","parents","innerWidth","enableSorting","fail","mouseenter","addClass","show","mouseleave","removeClass","absoluteUrl","baseUrl","attr","sortable","selector","drop","$el","delta","tileIds","map","index","obj","tileid","stringify","_authenticator","message","enablePatterns","tags","className","split","cssClass","pattern","substring","initPattern","TypeError","addLoader","portalUrl","loadManager","hasClass","ajaxSetup","cache","remove","dispatchEvent","addButton","target","err","trace","i18n","domain","loadCatalog","_","MessageFactory","require"],"mappings":"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","file":"tiles-management-compiled.js","sourcesContent":["define('tiles-management-pattern', [\n  'jquery',\n  'pat-base',\n  'pat-registry',\n  'mockup-patterns-modal',\n  'mockup-patterns-sortable',\n  'mockup-i18n',\n  'babel-polyfill',\n], function ($, Base, registry, Modal, Sortable, I18n) {\n  'use strict';\n  var Pattern = Base.extend({\n    name: 'tiles-management',\n    trigger: '.pat-tiles-management',\n    parser: 'mockup',\n    defaults: {},\n    init: function () {\n      const _this = this;\n      const managerId = this.options.managerId;\n\n      const isIE = (function () {\n        var ua = window.navigator.userAgent;\n        var msie = ua.indexOf('MSIE ');\n        if (msie > 0) {\n          // IE 10 or older => return version number\n          return true;\n        }\n\n        var trident = ua.indexOf('Trident/');\n        if (trident > 0) {\n          // IE 11 => return version number\n          return true;\n        }\n\n        var edge = ua.indexOf('Edge/');\n        if (edge > 0) {\n          // IE 12 (aka Edge) => return version number\n          return true;\n        }\n\n        // other browser\n        return false;\n      })();\n\n      const customEventPolyfill = function () {\n        if (typeof window.CustomEvent === 'function') return false;\n\n        function CustomEvent(event, params) {\n          params = params || {\n            bubbles: false,\n            cancelable: false,\n            detail: undefined,\n          };\n          var evt = document.createEvent('CustomEvent');\n          evt.initCustomEvent(\n            event,\n            params.bubbles,\n            params.cancelable,\n            params.detail,\n          );\n          return evt;\n        }\n\n        CustomEvent.prototype = window.Event.prototype;\n\n        window.CustomEvent = CustomEvent;\n      };\n\n      customEventPolyfill(); // for IE11 compatibility\n\n      const initializeAddButton = function (button, url) {\n        const $button = $(button);\n        var container = $button.next('.available-tiles');\n        if (container.length === 0) {\n          $button.parent().append('<div class=\"available-tiles\"></div>');\n          container = $button.next('.available-tiles');\n          container.hide();\n          container.load(url + ' #content .list-group', function () {\n            container.find('a.list-group-item').each(function () {\n              const addTileModal = new Modal($(this), {\n                actionOptions: {\n                  redirectOnResponse: true,\n                  timeout: 10000,\n                  redirectToUrl: window.location.href,\n                },\n              });\n              addTileModal.on('after-render', function () {\n                $('form#add_tile').append(\n                  '<input type=\"hidden\" name=\"managerId\" value=\"' +\n                  managerId +\n                  '\" />',\n                );\n              });\n            });\n\n            $(this).slideDown();\n          });\n        } else {\n          container.slideToggle();\n        }\n      };\n\n      const enableEditButtons = function (tile) {\n        //edit buttons modals\n        const $tile = $(tile);\n        $tile.find('div.tileEditButtons a.tileDeleteLink').each(function () {\n          const deleteModal = new Modal($(this), {\n            templateOptions: {\n              classModal: 'plone-modal-content delete-tile-modal',\n            },\n            actionOptions: {\n              redirectOnResponse: false,\n              timeout: 10000,\n              onSuccess: function (self, response, state, xhr, form) {\n                if (state === 'success') {\n                  self.hide();\n                  self.reloadWindow();\n                }\n              },\n            },\n          });\n          deleteModal.on('after-render', function () {\n            $('form#delete_tile').append(\n              '<input type=\"hidden\" name=\"managerId\" value=\"' +\n              managerId +\n              '\" />',\n            );\n          });\n        });\n\n        $tile.find('div.tileEditButtons a.tileEditLink').each(function () {\n          const editModal = new Modal($(this), {\n            templateOptions: {\n              classModal: 'plone-modal-content edit-tile-modal',\n            },\n            actionOptions: {\n              redirectOnResponse: true,\n              timeout: 10000,\n            },\n          });\n        });\n\n        $tile\n          .find(\n            'div.tileEditButtons a.tileVisibilityLink, div.tileEditButtons .tileSizeLink a',\n          )\n          .each(function () {\n            $(this).click(function (e) {\n              e.preventDefault();\n              let options = {\n                managerId: managerId,\n                ajax_load: true\n              };\n              if (isIE) {\n                options.invalidIECache = new Date().getTime();\n              }\n              $.get(e.currentTarget.href, options)\n                .done(function (data) {\n                  if (data !== undefined) {\n                    const result = JSON.parse(data);\n                    console.error(result.error);\n                    return;\n                  }\n\n                  const contentlUrl = $('body').data('baseUrl');\n                  const tilesInfosUrl = contentlUrl + '/tiles_management';\n                  let options = {\n                    managerId: managerId,\n                    ajax_load: true\n                  };\n                  if (isIE) {\n                    options.invalidIECache = new Date().getTime();\n                  }\n                  $.get(tilesInfosUrl, options).done(function (data) {\n                    const tileId = $tile.data('tileid');\n                    const html = $('<div></div>').html(data);\n                    const newTile = html.find(\n                      '.tilesList .tileWrapper[data-tileid=\"' + tileId + '\"]',\n                    );\n                    $tile.replaceWith(newTile);\n                    enableEditButtons(newTile);\n                    const container = newTile.parents('.tilesWrapper');\n                    if (container.length === 1 && window.innerWidth > 991) {\n                      enableSorting($(container[0]));\n                    }\n                  });\n                })\n                .fail(function (error) {\n                  console.error(error);\n                });\n            });\n          });\n\n        $tile\n          .mouseenter(function () {\n            $(this).addClass('editableTile');\n            $(this)\n              .find('.tileEditButtons')\n              .show();\n          })\n          .mouseleave(function () {\n            $(this).removeClass('editableTile');\n            $(this)\n              .find('.tileEditButtons')\n              .hide();\n          });\n      };\n\n      const enableSorting = function (container) {\n        const absoluteUrl = $('body').data().baseUrl || $('base').attr('href');\n        const sortable = new Sortable(container.find('.tilesList'), {\n          selector: 'div.tileWrapper',\n          drop: function ($el, delta) {\n            if (delta !== 0) {\n              const tileIds = $('.tileWrapper').map(function (index, obj) {\n                return $(obj).data().tileid;\n              });\n              if (absoluteUrl !== undefined) {\n                let options = {\n                  managerId: managerId,\n                  ajax_load: true,\n                  tileIds: JSON.stringify(tileIds.get()),\n                  _authenticator: $el.data('token'),\n                };\n                if (isIE) {\n                  options.invalidIECache = new Date().getTime();\n                }\n                $.get(absoluteUrl + '/reorder_tiles', options)\n                  .done(function (data) {\n                    if (data && data !== '') {\n                      const result = JSON.parse(data);\n                      console.error(result.message);\n                    }\n                  })\n                  .fail(function (error) {\n                    console.error(error);\n                  });\n              }\n            }\n          },\n        });\n      };\n\n      const enablePatterns = function (container) {\n        // we need to manually enable patterns of tiles loaded with ajax because\n        // sometimes these are loaded after pattern inits\n        const tags = container.find('[class*=\"pat-\"]');\n        if (tags.length === 0) {\n          return;\n        }\n\n        tags.each(function () {\n          const _this = this;\n          this.className.split(' ').map(function (cssClass) {\n            if (cssClass.indexOf('pat-') !== -1) {\n              const pattern = cssClass.substring(4);\n              try {\n                registry.initPattern(pattern, _this, cssClass);\n              } catch (e) {\n                if (e instanceof TypeError) {\n                  //pattern already registered\n                  return;\n                }\n              }\n            }\n          });\n        });\n      };\n\n      const addLoader = function (container) {\n        const portalUrl = $('body').data('portalUrl');\n        container.html(\n          '<div class=\"loading-tiles\"><img src=\"' +\n          portalUrl +\n          '/++resource++redturtle.tiles.management/loader.svg\" alt=\"loading\"/></div>',\n        );\n      };\n\n      const loadManager = function (container) {\n        const contentlUrl = $('body').data('baseUrl');\n        const tilesInfosUrl = contentlUrl + '/tiles_management';\n        addLoader(container);\n        let options = {\n          managerId: managerId,\n          ajax_load: true\n        };\n        if (isIE) {\n            options.invalidIECache = new Date().getTime();\n        }\n        if ($('body').hasClass('userrole-anonymous')){\n            $.ajaxSetup({cache: true});\n        }\n        $.get(tilesInfosUrl, options)\n          .done(function (data) {\n            // All subsequent Ajax calls using any function will use the new settings, \n            // unless overridden by the individual calls, until the next invocation of $.ajaxSetup().\n            $.ajaxSetup({cache: false});\n            const html = $(data);\n            if (!html.length) {\n              container.remove();\n              return;\n            }\n            container.html($(data));\n\n            //throw custom event to notify when tiles are loaded\n            var event = new CustomEvent('rtTilesLoaded');\n            container[0].dispatchEvent(event);\n\n            enablePatterns(container);\n\n            const addButton = container.find('.add-tile-btn');\n            if (addButton.length > 0) {\n              container.find('.tilesList .tileWrapper').each(function () {\n                container.find('.tileEditButtons').hide();\n                enableEditButtons(this);\n              });\n\n              if (window.innerWidth > 991) {\n                enableSorting(container);\n              }\n\n              addButton.each(function () {\n                $(this).click(function (e) {\n                  e.preventDefault();\n                  initializeAddButton($(this), e.target.href);\n                });\n              });\n            }\n          })\n          .fail(function (err) {\n            // All subsequent Ajax calls using any function will use the new settings, \n            // unless overridden by the individual calls, until the next invocation of $.ajaxSetup().\n            $.ajaxSetup({cache: false});\n            console.trace(err);\n            var i18n = new I18n();\n            const domain = 'redturtle.tiles.management';\n            i18n.loadCatalog(domain);\n            var _ = i18n.MessageFactory(domain);\n            container.html(\n              '<p class=\"error-manager\">' + _('error_loading_manager') + '</p>',\n            );\n          });\n      };\n\n      if (!managerId) {\n        _this.$el.append(\n          '<span>to use tiles manager, you need to provide a managerId attribute</span>',\n        );\n      } else {\n        loadManager(_this.$el);\n      }\n    },\n  });\n\n  return Pattern;\n});\n\nrequire([\n  'tiles-management-pattern',\n], function () {\n  'use strict';\n});\n\ndefine(\"src/redturtle/tiles/management/browser/static/bundle.js\", function(){});\n\n\n//# sourceMappingURL=tiles-management-compiled.js.map"]}